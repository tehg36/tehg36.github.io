---
layout: single
title:  "이론 공부 - 스레드(Thread)"
categories: Theory Study
tag: [Study, Theory, Thread]
toc: true
---

> ## 프로세스 

운영체제에 의해 메모리 공간을 할당받아 `CPU` 에서 `실행/제어` 되고 있는 프로그램이다.<br/>
종종 '스케줄링의 대상이 되는 작업' 이라는 용어와 같이 쓰인다.<br/>
`데이터 (data) + 자원(memory) + 스레드(thread)` 로 구성되어 실제로 프로그램이 실행되기까지는 스레드가 데이터 + 자원을 활용하여 작업을 수행한다.

> ## 스레드 (Thread)

하나의 프로세스 내에서 여러 개의 실행 흐름 (단일, 동시적, 병렬적) 을 두어 작업을 효율적으로 처리하기 위한 모델이다.<br/>
어떤 프로세스든 하나 이상의 스레드가 수행된다.<br/>
`두 개 이상의 스레드를 가지는 프로세스`를 `멀티스레드 프로세스`라고 한다.<br/>
`멀티스레드` 는 `주어진 자원을 극한으로 사용하기 위한 모델` 이다.

> ## 동시성

![Concurrency](/images/2023-04-11-Thread_posting/concurrency.gif){: align-center}

일반적으로 컴퓨터의 CPU는 한번에 하나의 일만 수행할 수 있다. 그래서 동시에 여러개의 프로세스를 작동하는건 불가능하다. 컴퓨터 과학에서 말하는 동시성은 CPU가 엄청 빠른 속도로 프로세스를 바꾸어 가면서 마치 사용자에게는 동시에 작동하는 것처럼 보이게 하는 것을 말한다. 여기서 `CPU가 프로세스를 바꾸는 작업을 컨텍스트 스위칭(Context Switching)` 이라고 한다.<br/>

여기서 스레드의 이점은, 기존 컨텍스트 스위칭은 프로세스 자체를 바꾸어야 하기 때문에, Code, Data, Heap, Stack 영역을 모두 초기화 하고 다시 불러오는 작업을 수행해야 하고 이는 오버헤드가 발생하는 작업이다. 스레드는 Stack을 제외하고 다른 영역을 공유하기 때문에 이러한 작업이 최소화 되어 훨씬 빠른 속도로 동작할 수 있다.

> ## 스레드와 프로세스의 차이점

프로세스는 완벽히 독립적이기 때문에 메모리 영역을 다른 프로세스와 공유하지 않는다.<br/>
반면, 스레드는 해당 스레드를 위한 스텍을 생성할 뿐 프로세스 내의 메모리를 공유해서 사용할 수 있다.

![ThreadVSProcess](/images/2023-04-11-Thread_posting/ThreadVSProcess.png){: align-center}

> ## 멀티 스레드 와 멀티 프로세스

여기서 멀티프로세스는 한 응용프로그램을 다수의 프로세스로 운용하는 것을 말한다.

![MultiProcessVSMultiThread](/images/2023-04-11-Thread_posting/MultiProcessVSMultiThread.png){: align-center}

한 프로그램을 실행한다고 해도, 그 프로그램 내에서 다양한 작업을 수행해야 한다면 당연히 다수의 스레드가 필요할 것이다. 이렇게 하나의 응용프로그램을 실행할때, `하나의 프로세스 안에서 다수의 스레드를 사용하는 방법` 을 `멀티 스레드` 라고 한다.<br/><br/>

`멀티 프로세스` 는 하나의 응용프로그램을 실행할때 다수의 프로세스를 사용하는 방법이다. 컨텍스트 스위칭에서 프로세스를 교체하는데 오버헤드가 많이 발생한다고 했는데 왜 굳이 멀티 프로세스를 사용하는가 하면, 이는 `안정성` 때문이다.<br/>
하나의 프로그램에서 하나의 프로세스만을 사용한다면 속도는 빨라질 수 있겠지만, 만약 그 프로세스에서 오류가 난다면 전체 프로그램이 죽어버리게 된다.<br/>
그러나 멀티 프로세스로 하나의 프로그램을 다수의 프로세스로 돌리면 그중 하나의 프로세스에서 오류가 발생한다고 해도 다른 모든 부분이 죽는 상황은 피할 수 있다.

> ## 멀티 스레드 (Multi Thread)

`멀티 스레딩(Multi-Threading)` 은 `하나의 프로그램 내에서 여러 개의 스레드를 생성하여 동시에 실행하는 것을 만한다.` 이를 통해 여러 작업을 동시에 처리하거나 병렬적으로 실행하는 등의 성능 향상을 기대할 수 있다.<br/><br/>

멀티 스레딩은 프로그래밍에서 매우 중요한 역할을 한다. 예를 들어, GUI 프로그램에서 사용자 인터페이스를 갱신하고 동시에 데이터를 처리하기 위해서는 멀티 스레딩이 필수적이다. 또한, 네트워크나 데이터베이스와 같은 외부자원을 사용하는 프로그램에서는 멀티 스레딩을 사용하여 대기 시간을 최소화하고 성능을 향상 시킬 수 있다.

> ## 스레드 구현

```cpp
#include <iostream>
#include <thread>
using namespace std;

void threadFunction(int n) {
    for (int i = 0; i < n; ++i) {
        cout << "Thread running " << i << endl;
    }
}

int main() {
    thread t1(threadFunction, 5); // 새로운 스레드1 생성
    thread t2(threadFunction, 3); // 새로운 스레드2 생성
    t1.join(); // 스레드1 종료 대기
    t2.join(); // 스레드2 종료 대기
    return 0;
}
```

위 코드에서 `threadFunction()` 함수는 새로운 스레드에서 실행된다. `thread()` 생성자를 사용하여 새로운 스레드를 생성하고, `join()` 함수를 사용하여 스레드가 종료될 때까지 대기한다.<br/><br/>

멀티 스레딩을 사용할 때는 스레드 간의 데이터 공유와 동기화에 대한 문제가 발생할 수 있다. C++ 에서는 `<mutex>` 헤더를 사용하여 스레드 간의 데이터 동기화를 제공한다. 또한, 스레드 간의 경쟁 상황(Race Condition)과 데드락(Deadlock) 에 대한 이해가 필요하다. 이러한 상황을 방지하기 위해 스레드 세이프(Thread-Safe) 한 코드 작성 방법을 고려해야한다.